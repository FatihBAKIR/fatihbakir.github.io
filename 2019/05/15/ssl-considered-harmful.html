<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.0 -->
<title>SSL considered harmful (in IoT)? | Fatih’s blog</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="SSL considered harmful (in IoT)?" />
<meta name="author" content="fatih" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Securing low power IoT devices is very resource consuming. Do we need lighter primitives?" />
<meta property="og:description" content="Securing low power IoT devices is very resource consuming. Do we need lighter primitives?" />
<link rel="canonical" href="https://blog.fatihbakir.net/2019/05/15/ssl-considered-harmful.html" />
<meta property="og:url" content="https://blog.fatihbakir.net/2019/05/15/ssl-considered-harmful.html" />
<meta property="og:site_name" content="Fatih’s blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-05-15T00:00:00-07:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"https://blog.fatihbakir.net/2019/05/15/ssl-considered-harmful.html","headline":"SSL considered harmful (in IoT)?","dateModified":"2019-05-15T00:00:00-07:00","datePublished":"2019-05-15T00:00:00-07:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.fatihbakir.net/2019/05/15/ssl-considered-harmful.html"},"author":{"@type":"Person","name":"fatih"},"description":"Securing low power IoT devices is very resource consuming. Do we need lighter primitives?","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://blog.fatihbakir.net/feed.xml" title="Fatih's blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Fatih&#39;s blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">SSL considered harmful (in IoT)?</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2019-05-15T00:00:00-07:00" itemprop="datePublished">May 15, 2019
      </time><!--<span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">fatih</span></span>-->
          •



  <img src="https://gravatar.com/avatar/35df13054d8d9aef497eaba29e97d087" class="onbellek-post-author-image"/>



  <span class="onbellek-post-author-name"> Fatih Bakir </span>

</p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>I’ve been working on <em>Internet of Things</em> research for over a year now. The bulk of it has been
working on getting cheap installations to work reliably and securely.</p>

<p>It’s a known fact that security hasn’t been the top priority of IoT applications, whether it’s a
temperature sensor, a thermostat or a smart bulb. They get hacked, they become part of botnets,
and if nothing, they reduce your downtime.</p>

<p>This is obviously not desirable. These things usually work over WiFi, so TCP/IP. So we should just 
slap our trusty SSL on top of it and call it a day, right?</p>

<p>Nope. The main problem many people don’t see is what separates the <em>Internet of Things</em> from the
regular internet. On the regular internet, we’ve mostly solved the security problems, and yes, the
solution is usually just encrypting the traffic. However, this solution just doesn’t scale <em>down</em>
to tiny embedded systems that are now part of the same internet as our crazy back end servers. Here,
the devices are extremely constrained.</p>

<p>Public key cryptography, which powers our security infrastructure on the internet, is not designed
to be run on processors with just a tens of megahertz clock speeds and a few KBs of RAM.</p>

<p>No, they were designed for huge machines. A conforming, bidirectional SSL server <strong>must</strong> be able
to keep about 33 kilobytes of buffers. The (relatively high end) microcontroller I’m using 
frequently only gives me about 48 kilobytes of RAM. So, if I wanted to run a full fledged SSL server
on it, I must waste two thirds of my RAM. Fortunately, you neither have to conform nor have to run
an SSL server on these things, so you can get away with about 5-10 KB of RAM for buffers.</p>

<p>But no, I’m not finished yet. Then we get to the point of actually using these buffers in an actual
SSL session. Regardless of whether you are a server or a client, you have to perform the dreaded
SSL handshake. Boy, oh boy. It takes slightly more than 4KB of stack to execute that. If you’re 
smart and looking for some adventure, you can probably use that wasted memory after the handshake
for some other purposes, but otherwise, it’ll just lay there after the handshake.</p>

<p>Oh, there’s also the issue of runtime. A single SSL handshake, on 2048 bit RSA keys will take about
4 seconds on an ESP8266. And no, ECC doesn’t help too much either.</p>

<table>
  <thead>
    <tr>
      <th>Operation</th>
      <th>Time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>RSA Handshake (2048 Bit)</td>
      <td>3,95 Seconds</td>
    </tr>
    <tr>
      <td>RSA Handshake (4096 Bit)</td>
      <td>32,32 Seconds</td>
    </tr>
  </tbody>
</table>

<p>I’m not an expert on SSL, but my understanding is that the handshake is bottlenecked at digital
signature operations. Here are the numbers for those primitives as well:</p>

<table>
  <thead>
    <tr>
      <th>Algorithm</th>
      <th>Sign Time</th>
      <th>Verify Time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>PKCS1 (2048 Bits)</td>
      <td>3280 ms</td>
      <td>187 ms</td>
    </tr>
    <tr>
      <td>PKCS1 (4096 Bits)</td>
      <td>31580 ms</td>
      <td>9190 ms</td>
    </tr>
    <tr>
      <td>ECDSA (256 Bits)</td>
      <td>214 ms</td>
      <td>4340 ms</td>
    </tr>
  </tbody>
</table>

<p>Now, 4 seconds isn’t a huge amount of time. My sensors are duty cycled to do a measurement every 5
minutes and go to sleep. So, running for 4 more extra seconds shouldn’t hurt, right?</p>

<p>The reason I’m going to sleep is to conserve power. We’re running on batteries here, and a regular
wake up-sample sensor-publish to cloud/edge-go back to sleep cycle takes about 2 seconds. Now, I just pay
twice that time just to do an SSL handshake. Oh, did I mention I’m on a WiFi network, which also has
encryption in the link layer. So, when I’m pushing to the edge, I probably don’t make use of the SSL
<em>at all</em>. It’s pure overhead.</p>

<p>Well, you might say that I don’t have to use SSL, so why complain this much. The reason is that every
single public cloud provider I’ve used (<a class="citation" href="#azure-mqtt-ssl">[1]</a>, <a class="citation" href="#aws-mqtt-ssl">[2]</a>, <a class="citation" href="#gc-mqtt-ssl">[3]</a>) 
expects me to publish only and only using SSL over MQTT.</p>

<p>Now, it’s not their fault. Security in this domain is extremely important. However, maybe porting
everything we’re used to in the regular internet programming to these constrained devices isn’t
the greatest idea. SSL (thus public key encryption) is truly a marvellous technology, but it’s solving
a very specific problem: you want to verify each parties identity * encrypt the communication * don’t 
want to share a lot of keys ahead of time.</p>

<p>For my commands to my thermostat, I don’t care a lot about the encryption. As long as I can verify
the authenticity of commands properly, an attacker cannot change my settings. Similarly for sensing
applications, if an attacker can’t inject random data to my public cloud database, I don’t really 
care about the data being encrypted, especially if I’m storing my data in an edge cloud where there
already exists a layer of security in link layer.</p>

<p>Maybe it’s time to search for lighter security primitives that can scale down to the embedded systems
we have to use in this domain. As otherwise, we’ll either not do it properly, or not do it at all.</p>

<h2 id="references">References</h2>

<ul class="bibliography"><li><span id="azure-mqtt-ssl">[1]“Azure IoT Hub communication protocols and ports | Microsoft Docs.” \urlhttps://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-devguide-protocols.</span></li>
<li><span id="aws-mqtt-ssl">[2]“Protocols - AWS IoT.” \urlhttps://docs.aws.amazon.com/iot/latest/developerguide/protocols.html.</span></li>
<li><span id="gc-mqtt-ssl">[3]“Publishing over the MQTT bridge  |  Cloud IoT Core Documentation  |  Google Cloud.” \urlhttps://cloud.google.com/iot/docs/how-tos/mqtt-bridge#mqtt_server.</span></li></ul>

  </div><a class="u-url" href="/2019/05/15/ssl-considered-harmful.html" hidden></a>
</article>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Fatih&#39;s blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Fatih&#39;s blog</li><li><a class="u-email" href="mailto:mfatihbakir@gmail.com">mfatihbakir@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/FatihBAKIR"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">FatihBAKIR</span></a></li><li><a href="https://www.twitter.com/mfatihbakir"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">mfatihbakir</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Blog </p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
